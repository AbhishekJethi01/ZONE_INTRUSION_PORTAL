<div class="mat-table-responsive thin-scroll">
    <table mat-table [dataSource]="dataSource" class="table custom-bordered-table mat-elevation-z8 shadow-none mb-0"
        style="width: 100%;" matSort (matSortChange)="announceSortChange($event)">
        <!-- Action Columns -->
        <ng-container matColumnDef="Action" *ngIf="isActionAvailable()" sticky>
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td mat-cell *matCellDef="let element" style="width: 1% !important;">
                <div class="action-btns d-flex align-items-center gap-1">
                    <button *ngIf="actionButtons?.view == 1" (click)="navigateToMode('view', element)"
                        class="btn btn-xs" style="background-color: #2bc652; color: white;" data-tooltip="tooltip"
                        data-bs-html="true" title="View">
                        <i data-feather="eye"></i>
                    </button>
                    <button *ngIf="actionButtons?.acknowledgment == 1" class="btn btn-xs"
                        (click)="navigateToMode('acknowledgment', element)"
                        style="background-color: #12cdb7; color: white;" data-tooltip="tooltip" data-bs-html="true"
                        title="Acknowledge" aria-label="Acknowledge">
                        <i data-feather="check-circle"></i>
                    </button>
                    <button *ngIf="actionButtons?.edit == 1" [disabled]="tableName == 'user' && loginUserName.toLowerCase() != 'admin'" (click)="navigateToMode('edit', element)"
                        class="btn btn-xs btn-primary" data-tooltip="tooltip" data-bs-html="true" aria-label="Edit"
                        data-bs-original-title="Edit" title="Edit"><i data-feather="edit"></i></button>
                    <button *ngIf="actionButtons?.delete == 1" [disabled]="element.userName?.toLowerCase() === 'admin' || (tableName == 'user' && loginUserName.toLowerCase() != 'admin')"
                        (click)="navigateToMode('delete', element)" class="btn btn-xs btn-danger" data-tooltip="tooltip"
                        data-bs-html="true" aria-label="Delete" data-bs-original-title="Delete" title="Delete"><i
                            data-feather="trash-2"></i></button>
                </div>
            </td>
        </ng-container>
        <!-- Dynamic Columns -->
        <ng-container *ngFor="let column of columns" [matColumnDef]="column.columnDef">
            <ng-container *ngIf="column.sortable; else noSort">
                <th mat-header-cell *matHeaderCellDef [style.min-width.px]="column.columnWidths"
                    [style.max-width.px]="column.columnWidths" [style.width.px]="column.columnWidths"
                    [mat-sort-header]="column.columnDef">
                    {{ column.header }}
                </th>
            </ng-container>
            <ng-template #noSort>
                <th mat-header-cell *matHeaderCellDef [style.min-width.px]="column.columnWidths" style="color: white;">
                    {{ column.header }}
                </th>
            </ng-template>
            <td mat-cell *matCellDef="let element" [style.min-width.px]="column.columnWidths"
                [style.max-width.px]="column.columnWidths" [style.width.px]="column.columnWidths">
                <ng-container [ngSwitch]="column.header">
                    <ng-container [ngSwitch]="true">
                        <ng-container *ngSwitchCase="tableName == 'vehicle' && column.header === 'Park Status'">
                            <div class="d-flex justify-content-center">
                                <span class="d-flex align-items-center gap-1 fw-semibold" [ngClass]="{
                        'text-success': element[column.columnDef] === true,
                        'text-danger': element[column.columnDef] === false
                      }">
                                    <ng-container *ngIf="element[column.columnDef] === true">
                                        <i class="bi bi-box-arrow-in-right"></i> Inside
                                    </ng-container>
                                    <ng-container *ngIf="element[column.columnDef] === false">
                                        <i class="bi bi-box-arrow-left"></i> Outside
                                    </ng-container>
                                </span>
                            </div>
                        </ng-container>
                        <ng-container *ngSwitchCase="tableName == 'vehicle' && column.header === 'Status'">
                            <div class="px-1 py-0 rounded-1 text-center d-inline-flex" [ngClass]="{
                                                        'text-success border-success': element[column.columnDef] === 0,
                                            'text-danger border-danger': element[column.columnDef] === 1
                                    }">
                                {{ element[column.columnDef] === 0 ? 'WhiteList' : 'BlackList' }}
                            </div>
                        </ng-container>
                        <ng-container
                            *ngSwitchCase="(column.header === 'Camera Status' || column.header === 'Status') && (tableName == 'camera' || tableName == 'boomBarrier')">
                            <div class="px-2 py-0 rounded-1 text-center d-inline-flex align-items-center" [ngClass]="{
      'border-success text-success': element[column.columnDef] === 'Connected',
      'border-danger text-danger': element[column.columnDef] === 'Disconnected',
      'border-warning text-warning': element[column.columnDef] !== 'Connected' && element[column.columnDef] !== 'Disconnected'
    }" style="justify-content: center;">
                                <ng-container [ngSwitch]="element[column.columnDef]">
                                    <ng-container *ngSwitchCase="'Connected'">
                                        <i class="bi bi-check-circle-fill me-1"></i> Connected
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'Disconnected'">
                                        <i class="bi bi-x-circle-fill me-1"></i> Disconnected
                                    </ng-container>
                                    <ng-container *ngSwitchDefault>
                                        <i class="bi bi-clock me-1"></i> Connecting...
                                    </ng-container>
                                </ng-container>
                            </div>
                        </ng-container>



                        <ng-container *ngSwitchCase="tableName == 'vehicle' && column.header.includes('Event')">
                            <button *ngIf="tableName == 'vehicle' && actionButtons?.viewEvent == 1"
                                (click)="navigateToMode('viewEvent', element)" class="btn btn-xs btn-warning"
                                data-tooltip="tooltip" data-bs-html="true" title="View Event"><i
                                    data-feather="calendar"></i></button>
                        </ng-container>
                        <ng-container *ngSwitchCase="tableName === 'vehicle' && column.columnDef === 'vehicleType'">
                            {{ getVehicleTypeLabel(element.vehicleType, element.tempVehicleExpiryDate) }}
                        </ng-container>
                        <ng-container
                            *ngSwitchCase="(column.header === 'Capture Time' || column.header === 'ACK Time') && (tableName == 'historicalEvent' || tableName == 'notification' || tableName == 'missedEvent')">
                            {{ formatDateTimeToAMPM(element[column.columnDef]) }}
                        </ng-container>
                        <ng-container
                            *ngSwitchCase="(tableName == 'historicalEvent' || tableName == 'notification' || tableName == 'missedEvent') && column.header.includes('Vehicle Image')">
                            <ng-container *ngIf="element[column.columnDef]; else noImage">
                                <img [src]="getImageUrl(element[column.columnDef])" alt="Vehicle Image" width="72"
                                    height="32" style="object-fit: cover; border-radius: 6px;"
                                    (click)="openImageModal(getImageUrl(element[column.columnDef]))" />
                            </ng-container>
                            <ng-template #noImage>
                                <span>N/A</span>
                            </ng-template>
                        </ng-container>

                        <ng-container *ngSwitchCase="(tableName == 'historicalEvent') && column.header.includes('Image')">
                        
                            <ng-container *ngIf="element[column.columnDef]; else noImage">
                                <img [src]="'data:image/jpeg;base64,' + element[column.columnDef]" alt="Vehicle Image" width="72" height="32"
                                    style="object-fit: cover; border-radius: 6px;"
                                    (click)="openImageModal('data:image/jpeg;base64,' + element[column.columnDef])" />
                            </ng-container>
                        
                            <ng-template #noImage>
                                <span>N/A</span>
                            </ng-template>
                        </ng-container>
                        
                        
                        <ng-container
                            *ngSwitchCase="(tableName == 'historicalEvent' || tableName == 'notification' || tableName == 'missedEvent') && column.header.includes('Number Plate Image')">
                            <ng-container *ngIf="element[column.columnDef]; else noPlate">
                                <img [src]="getImageUrl(element[column.columnDef])" alt="Vehicle Image" width="200" height="30"
                                    style="object-fit: contain; border-radius: 6px; max-height: 35px; width: 170px; background-color:#313a46; padding: 1px;"
                                    (click)="openVehicleNoPlateImageModal(getImageUrl(element[column.columnDef]))" />
                            </ng-container>
                            <ng-template #noPlate>
                                <span>N/A</span>
                            </ng-template>
                        </ng-container>

                        <ng-container
                            *ngSwitchCase="column.header === 'Camera/Direction' && (tableName === 'historicalEvent' || tableName === 'notification' || tableName == 'missedEvent')">
                            {{ element.direction }} [{{ element.cameraName }}]
                        </ng-container>
                        <!-- Radio Button for Enable Notification in Vehicle table -->
                        <ng-container *ngSwitchCase="tableName == 'vehicle' && column.header === 'Enable Notification'">
                            <div class="form-check form-switch d-flex justify-content-center m-0">
                                <input class="form-check-input" type="checkbox" role="switch"
                                    [checked]="element.vehicleStatus === 1 ? true : element[column.columnDef]"
                                    [disabled]="element.vehicleStatus === 1"
                                    (change)="element.vehicleStatus !== 1 && navigateToMode('toggle', element)" />
                            </div>
                        </ng-container>
                        <ng-container
                            *ngSwitchCase="(tableName == 'historicalEvent' || tableName == 'notification') && column.header.includes('Status')">
                            <div class="px-2 py-1 rounded-1 text-center d-inline-flex align-items-center gap-1 text-nowrap justify-center"
                                [ngClass]="{
                                                                  'text-warning-color':  element[column.columnDef] === 0,
                                                                  'text-success': element[column.columnDef] === 1,
                                                                  'text-danger': element[column.columnDef] === 2
                                                                }" style="justify-content: center;">

                                <ng-container *ngIf="element[column.columnDef] === 0">
                                    <i class="bi bi-exclamation-circle-fill"></i> Unknown
                                </ng-container>
                                <ng-container *ngIf="element[column.columnDef] === 1">
                                    <i class="bi bi-check-circle-fill"></i> WhiteList
                                </ng-container>
                                <ng-container *ngIf="element[column.columnDef] === 2">
                                    <i class="bi bi-x-circle-fill"></i> BlackList
                                </ng-container>
                            </div>
                        </ng-container>
                        <ng-container *ngSwitchCase="column.header.includes('Date')">
                            {{ element[column.columnDef] | date:'dd-MM-yyyy' }}
                        </ng-container>
                        <ng-container *ngSwitchDefault>
                            {{ element[column.columnDef] }}
                        </ng-container>
                    </ng-container>
                </ng-container>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="text-start"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="h-auto"></tr>
        <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" [attr.colspan]="displayedColumns.length"
                style="text-align: center; color: #ccc; font-size: 14px; padding: 16px;">
                No data available.
            </td>
        </tr>

    </table>
</div>
<mat-paginator *ngIf="!disablePagination && length > 0" #paginator [pageSizeOptions]="pageOptions" [length]="length"
    [pageIndex]="currentPage" [pageSize]="pageSize" (page)="pageChanged($event)" aria-label="Select page"
    showFirstLastButtons class="sticky bottom-0 z-[1]">
</mat-paginator>
<!-- <mat-paginator [disabled]="disablePagination" #paginator [length]="length" [pageSizeOptions]="pageOptions" [pageIndex]="currentPage"
    [pageSize]="pageSize" (page)="pageChanged($event)" showFirstLastButtons></mat-paginator> -->


<div class="modal fade cstModal" [id]="'vehicleImageModal-' + tableName" data-bs-backdrop="static"
    data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content py-0">
            <div class="modal-header d-flex align-items-center text-center flex-wrap py-2 border-0">
                <button type="button" class="btn-close img-dark close-for-single-img" data-bs-dismiss="modal"
                    (click)="closeModal()" aria-label="Close"></button>
            </div>
            <div class="modal-body z-index-3">
                <pinch-zoom [limit-zoom]="7" [disableZoomControl]="'disable'" *ngIf="showPinchZoom">
                    <img class="zoom-img" [src]="modalImageSrc" alt="Captured Image">
                </pinch-zoom>
            </div>
        </div>
    </div>
</div>




<!-- VehicleNumberPlate Image Modal -->
<div class="modal fade cstModal" [id]="'vehicleNoPlateImageModal-' + tableName" data-bs-backdrop="static"
    data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content py-0">
            <div class="modal-header d-flex align-items-center text-center flex-wrap py-2 border-0">
                <button type="button" class="btn-close img-dark close-for-single-img" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body z-index-3">
                <img class="full-img alpr-radius w-100" [src]="vehicleNoPlatemodalImageSrc" alt="">
            </div>
        </div>
    </div>
</div>